<!DOCTYPE html>
<html lang="pt-br">
<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDV MÃ¡gico âœ¨ Pro | Sistema Inteligente</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div id="particles-container"></div>
<div class="loader" id="loader"><div class="loader-spinner"></div><p>Carregando magia... âœ¨</p></div>

<!-- Auth Container -->
<div class="auth-container" id="authContainer">
    <div class="auth-card" id="loginCard">
        <div class="auth-header">
            <div class="auth-logo">âœ¨</div>
            <h1 class="auth-title">PDV MÃ¡gico Pro</h1>
            <p class="auth-subtitle">Sistema Inteligente de Vendas</p>
        </div>
        <form class="auth-form" id="loginForm">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="loginEmail" placeholder="seu@email.com" required>
            </div>
            <div class="form-group">
                <label class="form-label">Senha</label>
                <input type="password" class="form-input" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
            </div>
            <button type="submit" class="auth-btn"><i class="fas fa-sign-in-alt"></i> Entrar no Sistema</button>
            <div class="auth-switch">NÃ£o tem uma conta? <a onclick="showRegister()">Cadastre-se gratuitamente</a></div>
        </form>
    </div>
    
    <div class="auth-card" id="registerCard" style="display: none;">
        <div class="auth-header">
            <div class="auth-logo">ğŸš€</div>
            <h1 class="auth-title">Criar Conta</h1>
            <p class="auth-subtitle">7 dias grÃ¡tis, depois R$ 29,90/mÃªs</p>
        </div>
        <div class="plan-card">
            <div class="plan-badge">7 DIAS GRÃTIS</div>
            <h3>Plano Profissional</h3>
            <div class="plan-price">R$ 29,90</div>
            <div class="plan-period">por mÃªs</div>
            <ul class="plan-features">
                <li><i class="fas fa-check"></i> PDV Completo</li>
                <li><i class="fas fa-check"></i> GestÃ£o de Estoque</li>
                <li><i class="fas fa-check"></i> Dashboard AvanÃ§ado</li>
                <li><i class="fas fa-check"></i> Suporte 24/7</li>
            </ul>
        </div>
        <form class="auth-form" id="registerForm">
            <div class="form-group">
                <label class="form-label">Nome da Empresa</label>
                <input type="text" class="form-input" id="regCompany" placeholder="Sua Empresa LTDA" required>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">CNPJ/CPF</label>
                    <input type="text" class="form-input" id="regDocument" placeholder="00.000.000/0000-00">
                </div>
                <div class="form-group">
                    <label class="form-label">Telefone</label>
                    <input type="tel" class="form-input" id="regPhone" placeholder="(11) 99999-9999">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="regEmail" placeholder="seu@email.com" required>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Senha</label>
                    <input type="password" class="form-input" id="regPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required minlength="6">
                </div>
                <div class="form-group">
                    <label class="form-label">Confirmar</label>
                    <input type="password" class="form-input" id="regConfirmPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                </div>
            </div>
            <div class="terms-checkbox">
                <input type="checkbox" id="regTerms" required>
                <label for="regTerms">Concordo com os <a href="#" onclick="showTerms()">Termos de Uso</a></label>
            </div>
            <button type="submit" class="auth-btn"><i class="fas fa-rocket"></i> ComeÃ§ar PerÃ­odo GrÃ¡tis</button>
            <div class="auth-switch">JÃ¡ tem uma conta? <a onclick="showLogin()">FaÃ§a login</a></div>
        </form>
    </div>
</div>

<!-- App Container -->
<div class="app-container" id="appContainer">
    <nav class="sidebar">
        <button class="nav-btn active" onclick="switchTab('pdv')" title="Vendas">ğŸ›’<span class="nav-notification" id="cartNotification" style="display:none;">0</span></button>
        <button class="nav-btn" onclick="switchTab('stock')" title="Estoque">ğŸ“¦<span class="nav-notification" id="stockNotification" style="display:none;">0</span></button>
        <button class="nav-btn" onclick="switchTab('dashboard')" title="Dashboard">ğŸ“Š</button>
        <button class="nav-btn" onclick="openAccountModal()" title="Minha Conta">ğŸ‘¤</button>
        <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Modo Escuro">ğŸŒ™</button>
    </nav>

    <main class="content-area">
        <!-- PDV Section -->
        <section id="pdv" class="section active">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                <h2><i class="fas fa-cash-register"></i> Caixa Inteligente âœ¨</h2>
                <div class="stat-badge" id="subscriptionStatus" style="background:var(--success);color:white;"><i class="fas fa-crown"></i><span>Plano Ativo</span></div>
            </div>
            <div class="pdv-header">
                <input type="text" id="barcodeInput" class="scan-input" placeholder="ğŸ” Escaneie cÃ³digo ou digite nome... (F2 voz)" autofocus>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="openVoiceSearch()"><i class="fas fa-microphone"></i> Voz</button>
                    <button class="quick-action-btn" onclick="applyDiscount()"><i class="fas fa-tag"></i> Desconto</button>
                    <button class="quick-action-btn" onclick="openQuickProductModal()"><i class="fas fa-plus"></i> RÃ¡pido</button>
                </div>
            </div>
            <div class="suggestions-box" id="suggestionsBox"></div>
            <div class="live-stats">
                <div class="stat-badge"><i class="fas fa-shopping-cart"></i><span id="liveCartCount">0 itens</span></div>
                <div class="stat-badge"><i class="fas fa-dollar-sign"></i><span id="liveCartTotal">R$ 0,00</span></div>
                <div class="stat-badge"><i class="fas fa-bolt"></i><span id="liveProcessingTime">0s</span></div>
            </div>
            <div class="pdv-grid">
                <div class="product-list" id="productsGrid"></div>
                <div class="cart-panel">
                    <div class="cart-header">
                        <h3><i class="fas fa-shopping-basket"></i> Cesta de Compras</h3>
                        <button class="clear-cart" onclick="clearCart()" id="clearCartBtn" disabled><i class="fas fa-trash"></i> Limpar</button>
                    </div>
                    <div class="cart-items" id="cartItems">
                        <div style="text-align:center;color:#b2bec3;margin-top:50px;padding:30px;">
                            <i class="fas fa-shopping-basket" style="font-size:3rem;margin-bottom:15px;opacity:0.5;"></i>
                            <p>Sua cesta estÃ¡ vazia ğŸƒ</p>
                        </div>
                    </div>
                    <div class="cart-footer">
                        <div class="cart-total"><span class="cart-total-label">Total:</span><span id="cartTotal">R$ 0,00</span></div>
                        <button class="btn-checkout" id="btnCheckout" onclick="openPaymentModal()" disabled><i class="fas fa-rocket"></i> Finalizar Venda ğŸš€</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stock Section -->
        <section id="stock" class="section">
            <h2><i class="fas fa-boxes"></i> GestÃ£o de Estoque ğŸ“¦</h2>
            <div class="form-add">
                <input type="text" id="newProdName" placeholder="Nome do Produto" oninput="suggestEmoji()">
                <input type="number" id="newProdPrice" placeholder="PreÃ§o (R$)" step="0.01" min="0">
                <input type="number" id="newProdStock" placeholder="Quantidade" min="0">
                <select id="newProdCategory">
                    <option value="">Categoria...</option>
                    <option value="alimento">ğŸ” Alimentos</option>
                    <option value="bebida">ğŸ¥¤ Bebidas</option>
                    <option value="limpeza">ğŸ§¼ Limpeza</option>
                    <option value="eletronico">ğŸ“± EletrÃ´nicos</option>
                    <option value="vestuario">ğŸ‘• VestuÃ¡rio</option>
                    <option value="outro">ğŸ“¦ Outros</option>
                </select>
                <div style="position:relative;flex:1;">
                    <input type="text" id="newProdEmoji" placeholder="Emoji" list="emojiList" oninput="filterEmojiList()">
                    <datalist id="emojiList"></datalist>
                    <div id="emojiPreview" style="position:absolute;right:15px;top:50%;transform:translateY(-50%);font-size:1.5rem;">ğŸ“¦</div>
                </div>
                <button class="btn-checkout" style="width:auto;padding:14px 25px;" onclick="addProduct()"><i class="fas fa-plus-circle"></i> Adicionar</button>
            </div>
            <div class="table-container">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                    <h3>Produtos Cadastrados</h3>
                    <div style="display:flex;gap:10px;">
                        <input type="text" id="stockSearch" placeholder="Buscar..." style="width:200px;" oninput="filterStockTable()">
                        <button class="quick-action-btn" onclick="exportStockCSV()"><i class="fas fa-file-export"></i> Exportar</button>
                    </div>
                </div>
                <table id="stockTable">
                    <thead><tr><th>Item</th><th>PreÃ§o</th><th>Estoque</th><th>Categoria</th><th>AÃ§Ãµes</th></tr></thead>
                    <tbody id="stockTableBody"></tbody>
                </table>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section id="dashboard" class="section">
            <h2><i class="fas fa-chart-line"></i> Dashboard ğŸ“ˆ</h2>
            <div class="dashboard-cards">
                <div class="card-metric"><div class="metric-icon">ğŸ’°</div><div class="metric-info"><p>Vendas Hoje</p><h3 id="dashTotalSales">R$ 0,00</h3></div></div>
                <div class="card-metric"><div class="metric-icon">ğŸ§¾</div><div class="metric-info"><p>Tickets</p><h3 id="dashTotalTickets">0</h3></div></div>
                <div class="card-metric"><div class="metric-icon">ğŸ”¥</div><div class="metric-info"><p>Mais Vendido</p><h3 id="dashTopProduct">-</h3></div></div>
                <div class="card-metric"><div class="metric-icon">ğŸ“¦</div><div class="metric-info"><p>Estoque Baixo</p><h3 id="dashLowStock">0</h3></div></div>
            </div>
            <div class="chart-container">
                <h3>Vendas por PerÃ­odo</h3>
                <canvas id="salesChart" style="width:100%;height:300px;"></canvas>
            </div>
            <div class="table-container">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                    <h3>HistÃ³rico de Vendas</h3>
                    <div style="display:flex;gap:10px;">
                        <select id="salesFilter" onchange="filterSalesHistory()">
                            <option value="all">Todas</option>
                            <option value="today">Hoje</option>
                            <option value="week">Semana</option>
                            <option value="month">MÃªs</option>
                        </select>
                        <button class="quick-action-btn" onclick="exportSalesCSV()"><i class="fas fa-download"></i> Exportar</button>
                    </div>
                </div>
                <table><thead><tr><th>Data</th><th>MÃ©todo</th><th>Itens</th><th>Total</th></tr></thead><tbody id="salesHistoryBody"></tbody></table>
            </div>
        </section>
    </main>
</div>

<!-- Low Stock Badge -->
<div class="low-stock-badge" id="lowStockBadge" onclick="switchTab('stock')" style="display:none;">
    <i class="fas fa-exclamation-triangle"></i>
    <div><strong id="lowStockCount">0</strong> com estoque baixo</div>
</div>

<!-- Floating Action Button -->
<button class="floating-action-btn" id="floatingActionBtn" onclick="quickSale()"><i class="fas fa-bolt"></i></button>

<!-- Payment Modal -->
<div class="modal-overlay" id="paymentModal">
    <div class="modal-content">
        <h2>Pagamento ğŸ’¸</h2>
        <p style="color:#636e72;">Total:</p>
        <p style="font-size:2.5rem;font-weight:900;color:var(--primary);" id="modalTotalValue">R$ 0,00</p>
        <div style="margin:20px 0;padding:15px;background:#f8f9fa;border-radius:16px;">
            <div style="display:flex;justify-content:space-between;"><span>Subtotal:</span><span id="modalSubtotal">R$ 0,00</span></div>
            <div style="display:flex;justify-content:space-between;"><span>Desconto:</span><span id="modalDiscount" style="color:var(--success);">R$ 0,00</span></div>
        </div>
        <div class="payment-options">
            <button class="btn-pay" onclick="processPayment('Pix')"><i class="fas fa-qrcode"></i> ğŸ’  Pix (5% OFF)</button>
            <button class="btn-pay" onclick="processPayment('CartÃ£o CrÃ©dito')"><i class="fas fa-credit-card"></i> ğŸ’³ CrÃ©dito</button>
            <button class="btn-pay" onclick="processPayment('CartÃ£o DÃ©bito')"><i class="fas fa-credit-card"></i> ğŸ’³ DÃ©bito</button>
            <button class="btn-pay" onclick="processPayment('Dinheiro')"><i class="fas fa-money-bill-wave"></i> ğŸ’µ Dinheiro</button>
        </div>
        <button class="btn-checkout" style="background:#ff7675;margin-top:20px;" onclick="closePaymentModal()"><i class="fas fa-times"></i> Cancelar</button>
    </div>
</div>

<!-- Receipt Modal -->
<div class="modal-overlay" id="receiptModal">
    <div class="modal-content">
        <h2>Venda Finalizada! ğŸ‰</h2>
        <div style="background:#f8f9fa;padding:20px;border-radius:16px;margin:20px 0;text-align:left;">
            <p><strong>ID:</strong> <span id="receiptId">#0000</span></p>
            <p><strong>Data:</strong> <span id="receiptDate">00/00/0000</span></p>
            <p><strong>Pagamento:</strong> <span id="receiptMethod">-</span></p>
            <p><strong>Total:</strong> <span id="receiptTotal" style="color:var(--primary);font-weight:900;">R$ 0,00</span></p>
        </div>
        <div class="receipt-options">
            <button class="btn-receipt btn-print" onclick="printReceipt()"><i class="fas fa-print"></i> Imprimir</button>
            <button class="btn-receipt btn-whatsapp" onclick="sendViaWhatsapp()"><i class="fab fa-whatsapp"></i> WhatsApp</button>
            <button class="btn-receipt btn-email" onclick="sendViaEmail()"><i class="fas fa-envelope"></i> Email</button>
        </div>
        <button class="btn-checkout" style="background:#b2bec3;margin-top:20px;" onclick="closeReceiptModal()"><i class="fas fa-redo"></i> Nova Venda</button>
    </div>
</div>

<!-- Quick Product Modal -->
<div class="modal-overlay" id="quickProductModal">
    <div class="modal-content">
        <h2>Produto RÃ¡pido âš¡</h2>
        <div style="margin:25px 0;">
            <input type="text" id="quickProdName" placeholder="Nome do produto" style="width:100%;margin-bottom:15px;">
            <input type="number" id="quickProdPrice" placeholder="PreÃ§o (R$)" step="0.01" min="0" style="width:100%;margin-bottom:15px;">
            <div style="display:flex;gap:10px;">
                <button class="btn-checkout" style="flex:1;background:#ff7675;" onclick="closeQuickProductModal()">Cancelar</button>
                <button class="btn-checkout" style="flex:2;" onclick="addQuickProduct()"><i class="fas fa-bolt"></i> Adicionar</button>
            </div>
        </div>
    </div>
</div>

<!-- Account Modal -->
<div class="modal-overlay" id="accountModal">
    <div class="modal-content">
        <h2>Minha Conta ğŸ‘¤</h2>
        <div style="text-align:center;margin-bottom:25px;">
            <div style="width:80px;height:80px;background:linear-gradient(135deg,var(--primary),var(--secondary));border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 15px;color:white;font-size:2rem;">ğŸ‘‘</div>
            <h3 id="accountCompanyName">Empresa</h3>
            <p style="color:var(--text-light);" id="accountEmail">email@empresa.com</p>
        </div>
        <div style="background:#f8f9fa;padding:20px;border-radius:16px;margin-bottom:25px;">
            <div style="display:flex;justify-content:space-between;margin-bottom:10px;"><span>Plano:</span><span id="accountPlanStatus" style="font-weight:700;color:var(--primary);">PROFISSIONAL</span></div>
            <div style="display:flex;justify-content:space-between;margin-bottom:10px;"><span>VÃ¡lido atÃ©:</span><span id="accountValidUntil">00/00/0000</span></div>
            <div style="display:flex;justify-content:space-between;"><span>CNPJ/CPF:</span><span id="accountDocument">-</span></div>
        </div>
        <button class="btn-checkout" style="background:#ff7675;" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</button>
        <button class="btn-checkout" style="background:#b2bec3;margin-top:10px;" onclick="closeAccountModal()">Fechar</button>
    </div>
</div>

<!-- Terms Modal -->
<div class="modal-overlay" id="termsModal">
    <div class="modal-content" style="max-height:80vh;overflow-y:auto;">
        <h2>Termos de Uso ğŸ“œ</h2>
        <div style="text-align:left;margin:20px 0;font-size:0.9rem;line-height:1.6;">
            <h4>1. AceitaÃ§Ã£o</h4>
            <p>Ao usar o PDV MÃ¡gico Pro, vocÃª concorda com estes termos.</p>
            <h4>2. ServiÃ§o</h4>
            <p>Oferecemos sistema de PDV com 7 dias grÃ¡tis, depois R$ 29,90/mÃªs.</p>
            <h4>3. Dados</h4>
            <p>Seus dados sÃ£o armazenados com seguranÃ§a no Supabase.</p>
            <h4>4. Cancelamento</h4>
            <p>Cancele a qualquer momento sem multas.</p>
        </div>
        <button class="btn-checkout" onclick="closeTermsModal()">Entendi</button>
    </div>
</div>

<!-- Toast -->
<div id="toast" class="toast"><i class="fas fa-check-circle toast-icon"></i><span class="toast-message">OK</span></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="app.js"></script>
</body>
</html>

